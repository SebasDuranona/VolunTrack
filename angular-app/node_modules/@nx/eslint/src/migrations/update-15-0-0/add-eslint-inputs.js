"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const devkit_1 = require("@nx/devkit");
const eslint_targets_1 = require("../../generators/utils/eslint-targets");
const config_file_1 = require("../../utils/config-file");
async function addEslintInputs(tree) {
    const nxJson = (0, devkit_1.readNxJson)(tree);
    const globalEslintFile = config_file_1.ESLINT_CONFIG_FILENAMES.find((file) => tree.exists(file));
    if (globalEslintFile && nxJson.namedInputs?.production) {
        const productionFileset = new Set(nxJson.namedInputs.production);
        productionFileset.add(`!{projectRoot}/${globalEslintFile}`);
        nxJson.namedInputs.production = Array.from(productionFileset);
    }
    for (const targetName of (0, eslint_targets_1.getEslintTargets)(tree)) {
        nxJson.targetDefaults ??= {};
        const lintTargetDefaults = (nxJson.targetDefaults[targetName] ??= {});
        lintTargetDefaults.inputs ??= [
            'default',
            ...(globalEslintFile
                ? [(0, devkit_1.joinPathFragments)('{workspaceRoot}', globalEslintFile)]
                : []),
        ];
    }
    (0, devkit_1.updateNxJson)(tree, nxJson);
    await (0, devkit_1.formatFiles)(tree);
}
exports.default = addEslintInputs;
