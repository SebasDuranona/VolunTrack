"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const devkit_1 = require("@nx/devkit");
async function default_1(tree) {
    (0, devkit_1.updateJson)(tree, 'package.json', (json) => {
        if (!json.scripts?.postinstall?.includes('ngcc ')) {
            return json;
        }
        json.scripts.postinstall = json.scripts.postinstall
            // special case when ngcc is at the start so we remove the && as well
            .replace(/^(ngcc.*?&& *)(.*)/, '$2')
            // everything else
            .replace(/(.*?)((&& *)?ngcc.*?)((?=&)|$)(.*)/, '$1$5')
            .trim();
        if (json.scripts.postinstall === '') {
            json.scripts.postinstall = undefined;
        }
        return json;
    });
    await (0, devkit_1.formatFiles)(tree);
}
exports.default = default_1;
