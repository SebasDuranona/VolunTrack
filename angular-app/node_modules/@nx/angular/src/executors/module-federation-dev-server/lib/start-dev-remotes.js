"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.startDevRemotes = void 0;
const devkit_1 = require("@nx/devkit");
async function startDevRemotes(remotes, workspaceProjects, options, context) {
    const devRemotesIters = [];
    for (const app of remotes.devRemotes) {
        if (!workspaceProjects[app].targets?.['serve']) {
            throw new Error(`Could not find "serve" target in "${app}" project.`);
        }
        else if (!workspaceProjects[app].targets?.['serve'].executor) {
            throw new Error(`Could not find executor for "serve" target in "${app}" project.`);
        }
        const [collection, executor] = workspaceProjects[app].targets['serve'].executor.split(':');
        const isUsingModuleFederationDevServerExecutor = executor.includes('module-federation-dev-server');
        devRemotesIters.push(await (0, devkit_1.runExecutor)({
            project: app,
            target: 'serve',
            configuration: context.configurationName,
        }, {
            verbose: options.verbose ?? false,
            ...(isUsingModuleFederationDevServerExecutor
                ? { isInitialHost: false }
                : {}),
        }, context));
    }
    return devRemotesIters;
}
exports.startDevRemotes = startDevRemotes;
