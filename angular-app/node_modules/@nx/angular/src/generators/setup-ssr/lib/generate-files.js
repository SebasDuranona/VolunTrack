"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.generateSSRFiles = void 0;
const devkit_1 = require("@nx/devkit");
const semver_1 = require("semver");
const version_utils_1 = require("../../utils/version-utils");
function generateSSRFiles(tree, schema, isUsingApplicationBuilder) {
    const { root: projectRoot, targets } = (0, devkit_1.readProjectConfiguration)(tree, schema.project);
    if (targets.server ||
        (isUsingApplicationBuilder && targets.build.options?.server !== undefined)) {
        // server has already been added
        return;
    }
    const pathToFiles = (0, devkit_1.joinPathFragments)(__dirname, '..', 'files');
    const { version: angularVersion } = (0, version_utils_1.getInstalledAngularVersionInfo)(tree);
    if (schema.standalone) {
        (0, devkit_1.generateFiles)(tree, (0, devkit_1.joinPathFragments)(pathToFiles, 'standalone'), projectRoot, { ...schema, tpl: '' });
    }
    else {
        (0, devkit_1.generateFiles)(tree, (0, devkit_1.joinPathFragments)(pathToFiles, 'ngmodule', 'base'), projectRoot, { ...schema, tpl: '' });
        if ((0, semver_1.lt)(angularVersion, '15.2.0')) {
            (0, devkit_1.generateFiles)(tree, (0, devkit_1.joinPathFragments)(pathToFiles, 'ngmodule', 'pre-v15-2'), projectRoot, { ...schema, tpl: '' });
        }
    }
}
exports.generateSSRFiles = generateSSRFiles;
