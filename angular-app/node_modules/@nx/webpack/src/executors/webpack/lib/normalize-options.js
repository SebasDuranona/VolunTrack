"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.normalizePluginPath = exports.normalizeOptions = void 0;
const path_1 = require("path");
const normalize_options_1 = require("../../../plugins/nx-webpack-plugin/lib/normalize-options");
function normalizeOptions(options, root, projectRoot, sourceRoot) {
    const normalizedOptions = {
        ...options,
        root,
        projectRoot,
        sourceRoot,
        target: options.target ?? 'web',
        outputFileName: options.outputFileName ?? 'main.js',
        webpackConfig: normalizePluginPath(options.webpackConfig, root),
        fileReplacements: (0, normalize_options_1.normalizeFileReplacements)(root, options.fileReplacements),
        optimization: typeof options.optimization !== 'object'
            ? {
                scripts: options.optimization,
                styles: options.optimization,
            }
            : options.optimization,
    };
    if (options.assets) {
        normalizedOptions.assets = (0, normalize_options_1.normalizeAssets)(options.assets, root, sourceRoot, projectRoot, false // executor assets are relative to workspace root for consistency
        );
    }
    return normalizedOptions;
}
exports.normalizeOptions = normalizeOptions;
function normalizePluginPath(pluginPath, root) {
    if (!pluginPath) {
        return '';
    }
    try {
        return require.resolve(pluginPath);
    }
    catch {
        return (0, path_1.resolve)(root, pluginPath);
    }
}
exports.normalizePluginPath = normalizePluginPath;
