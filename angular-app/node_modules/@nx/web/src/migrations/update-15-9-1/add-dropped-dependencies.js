"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const devkit_1 = require("@nx/devkit");
async function addDroppedDependencies(tree) {
    const devDependencies = {};
    const droppedDependencies = [
        '@nrwl/linter',
        '@nrwl/cypress',
        '@nrwl/jest',
        '@nrwl/rollup',
    ];
    const projects = (0, devkit_1.getProjects)(tree);
    for (const [_, projectConfiguration] of projects) {
        for (const [_, targetConfiguration] of Object.entries(projectConfiguration.targets ?? {})) {
            for (const droppedDependency of droppedDependencies) {
                if (targetConfiguration?.['executor']?.startsWith(droppedDependency + ':')) {
                    devDependencies[droppedDependency] = devkit_1.NX_VERSION;
                }
            }
        }
    }
    const nxJson = (0, devkit_1.readNxJson)(tree);
    for (const [_, targetConfiguration] of Object.entries(nxJson?.targetDefaults ?? {})) {
        for (const droppedDependency of droppedDependencies) {
            if (targetConfiguration?.['executor']?.startsWith(droppedDependency + ':')) {
                devDependencies[droppedDependency] = devkit_1.NX_VERSION;
            }
        }
    }
    if (Object.keys(devDependencies).length > 0) {
        (0, devkit_1.addDependenciesToPackageJson)(tree, {}, devDependencies);
    }
    await (0, devkit_1.formatFiles)(tree);
}
exports.default = addDroppedDependencies;
